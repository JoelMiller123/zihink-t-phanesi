<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Soru Sor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body { margin: 0; background-color: black; color: white; overflow-x: hidden; }
        canvas#bgCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }

        .card { border-radius: 12px; transition: transform 0.2s, box-shadow 0.2s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.4); }
        .card-title i { margin-right: 8px; }
        .answer-paragraph { padding: 8px 14px; margin-bottom: 10px; border-radius: 10px; background-color: #00000088; color: white; animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from {opacity:0; transform: translateY(10px);} to {opacity:1; transform: translateY(0);} }
        .container { z-index: 1; position: relative; max-width: 800px; margin-top: 50px; }
        .wikipedia-card { border-left: 6px solid #28a745; background-color: #1b3e1bcc; }
        .google-card { border-left: 6px solid #007bff; background-color: #1b1f3dcc; }

        /* Neon Navbar Stil */
        .navbar-custom {
            background-color: #1c1c1c;
            padding: 0.8rem 1rem;
        }
        .neon-text {
            font-weight: 600;
            color: #ff0033;
            text-shadow:
                0 0 5px #ff0033,
                0 0 10px #ff0033,
                0 0 20px #ff0033,
                0 0 40px #ff0033;
            transition: text-shadow 0.2s;
        }
        .neon-link {
            color: #fff;
            font-weight: 500;
            transition: color 0.2s, text-shadow 0.2s;
        }
        .neon-link:hover {
            color: #ff0033;
            text-shadow:
                0 0 5px #ff0033,
                0 0 10px #ff0033,
                0 0 20px #ff0033;
        }
        .navbar-toggler-icon { filter: invert(1); }
    </style>
</head>
<body>
    <!-- Neon Navbar -->
    <nav class="navbar navbar-expand-lg navbar-custom">
        <div class="container-fluid">
            <a class="navbar-brand neon-text" href="/">Zihin Kütüphanesi</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link neon-link" href="/">Ana Sayfa</a></li>
                    <li class="nav-item"><a class="nav-link neon-link" href="/ask">Soru Sor</a></li>
                    <li class="nav-item"><a class="nav-link neon-link" href="/library">Kütüphanem</a></li>
                    <li class="nav-item"><a class="nav-link neon-link" href="/about">Hakkında</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <canvas id="bgCanvas"></canvas>

    <div class="container">
        <h1 class="mb-4 text-center">Soru Sor</h1>
        
        <!-- Soru Sor Formu + Spinner -->
        <form method="post" id="questionForm">
            <div class="mb-3">
                <textarea name="question" class="form-control form-control-lg" placeholder="Sorunuzu buraya yazın..." rows="4" required></textarea>
            </div>
            <button type="submit" class="btn btn-secondary btn-lg w-100" id="submitBtn">
                <span id="btnText">Sor</span>
                <span id="btnSpinner" class="spinner-border spinner-border-sm ms-2" role="status" style="display: none;"></span>
            </button>
        </form>

        {% if answers %}
            <h3 class="mt-5 mb-3">Cevaplar:</h3>
            <div class="d-flex flex-column gap-3">
                {% for a in answers %}
                    <div class="card shadow-sm google-card p-3">
                        <div class="card-body">
                            <h5 class="card-title text-primary">
                                <i class="bi bi-globe2"></i> {{ a.title }}
                            </h5>
                            <div class="answer-paragraph">{{ a.snippet }}</div>
                            <a href="{{ a.link }}" target="_blank" class="btn btn-primary btn-sm mt-2">Kaynağa git</a>

                            <!-- Kütüphaneye ekle butonu -->
                            <form method="POST" action="/save" class="mt-2">
                                <input type="hidden" name="title" value="{{ a.title }}">
                                <input type="hidden" name="content" value="{{ a.snippet }}">
                                <button type="submit" class="btn btn-outline-light btn-sm">Kütüphaneme Ekle</button>
                            </form>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Spinner JS -->
    <script>
    const form = document.getElementById('questionForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const btnSpinner = document.getElementById('btnSpinner');

    form.addEventListener('submit', () => {
        submitBtn.disabled = true;
        btnText.style.display = 'none';
        btnSpinner.style.display = 'inline-block';
    });
    </script>

    <!-- Matrix Arka Plan -->
    <script>
    const canvas = document.getElementById("bgCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()";
    const fontSize = 18;
    const columns = canvas.width / fontSize;
    const drops = Array.from({length: columns}).map(() => 1);
    function draw() {
        ctx.fillStyle = "rgba(0, 0, 0, 0.05)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#ffffff";
        ctx.font = fontSize + "px monospace";
        for (let i = 0; i < drops.length; i++) {
            const text = letters.charAt(Math.floor(Math.random() * letters.length));
            ctx.fillText(text, i * fontSize, drops[i] * fontSize);
            if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) { drops[i] = 0; }
            drops[i]++;
        }
    }
    setInterval(draw, 50);
    window.addEventListener("resize", () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
    </script>

</body>
</html>
